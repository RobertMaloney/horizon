var fs=require("fs"),remote=require("remote"),Menu=remote.require("menu"),ws=require("../lib/windows-shortcuts/lib/windows-shortcuts.js"),ie=require("../lib/iconextractor/iconextractor.js"),PanelData=function(e){this.name=e,this.links=[]};PanelData.prototype.addLink=function(e){return this.links.push(e),!0},PanelData.prototype.removeAt=function(e){return e>=this.links.length?!1:0>e?!1:("undefined"!=typeof this.links[e].imageuri&&fs.unlink("build/"+this.links[e].imageuri,function(e){e&&console.log("Delete failed.")}),this.links.splice(e,1),!0)},PanelData.prototype.addFileByEvent=function(e,t){e.preventDefault();var i=e.dataTransfer.files[0],n=this.addLink.bind(this);parseConfig(i.path,function(e,i){e||ie.extractIcon(i.uri,i.name,function(r,a){r||(i.imageuri=a),n(i),t(!e)})})},PanelData.prototype.makeContext=function(e,t){var i=this.removeAt.bind(this,e),n=function(e){"delete"===e&&i(),t()},r=Menu.buildFromTemplate([{label:"Delete",click:n.bind(this,"delete")}]);r.popup(remote.getCurrentWindow())};var parseConfig=function(e,t){var i=!1,n=e.slice(e.lastIndexOf("\\")+1),r=fs.lstatSync(e);if(r.isDirectory())t(i,{name:n,uri:e});else{var a=n.slice(n.lastIndexOf(".")+1);n=n.slice(0,n.lastIndexOf(".")),"lnk"===a?ws.query(e,function(e,i){t(e,{name:n,uri:i.target})}):t(i,{name:n,uri:e})}};module.exports=PanelData;