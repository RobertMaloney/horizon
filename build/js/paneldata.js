var fs=require("fs"),remote=require("remote"),Menu=remote.require("menu"),ws=require("../lib/windows-shortcuts/lib/windows-shortcuts.js"),PanelData=function(e){this.name=e,this.links=[]};PanelData.prototype.addLink=function(e){return this.links.push({name:e.name,uri:e.uri}),!0},PanelData.prototype.removeAt=function(e){return e>=this.links.length?!1:0>e?!1:(this.links.splice(e,1),!0)},PanelData.prototype.addFileByEvent=function(e,t){e.preventDefault();var n=e.dataTransfer.files[0],i=this.addLink.bind(this);parseConfig(n.path,function(e,n){e||i(n),t(!e)})},PanelData.prototype.makeContext=function(e,t){var n=this.removeAt.bind(this,e),i=function(e){"delete"===e&&n(),t()},a=Menu.buildFromTemplate([{label:"Delete",click:i.bind(this,"delete")}]);a.popup(remote.getCurrentWindow())};var parseConfig=function(e,t){var n=!1,i=e.slice(e.lastIndexOf("\\")+1),a=fs.lstatSync(e);if(a.isDirectory())t(n,{name:i,uri:e});else{var r=i.slice(i.lastIndexOf(".")+1);i=i.slice(0,i.lastIndexOf(".")),"lnk"===r?ws.query(e,function(e,n){t(e,{name:i,uri:n.target})}):t(n,{name:i,uri:e})}};module.exports=PanelData;